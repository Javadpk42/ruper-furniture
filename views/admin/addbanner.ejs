
<%-include("../adminlayouts/header.ejs")-%>




<style>
  .image-preview img {
  max-width: 100%;
  max-height: 100%;
  border: 1px solid #ddd; /* Add a border for better visualization */
}

</style>



  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href=" https://demos.creative-tim.com/material-dashboard/pages/dashboard " target="_blank">
        <img src="/public/admin/img/logo-white.png" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold text-white"></span>
      </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/dashboard">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">dashboard</i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link text-white  " href="/admin/salesreport">
              <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">receipt_long</i>
              </div>
              <span class="nav-link-text ms-1">Sales Report</span>
            </a>
          </li>
        <li class="nav-item">
          <a class="nav-link text-white  " href="/admin/customers">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">person</i>
            </div>
            <span class="nav-link-text ms-1">Customers</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/categories">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Categories</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white  " href="/admin/products">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">view_in_ar</i>
            </div>
            <span class="nav-link-text ms-1">Products</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/orders">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">format_textdirection_r_to_l</i>
            </div>
            <span class="nav-link-text ms-1">Orders</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/coupons">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">table_view</i>
            </div>
            <span class="nav-link-text ms-1">Coupons</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/offer">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">assignment</i>
            </div>
            <span class="nav-link-text ms-1">Offers</span>
          </a>
        </li>
     
        <li class="nav-item">
          <a class="nav-link text-white bg-gradient-primary" href="/admin/banner">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">notifications</i>
            </div>
            <span class="nav-link-text ms-1">Banners</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/logout">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">login</i>
            </div>
            <span class="nav-link-text ms-1">Logout</span>
          </a>
        </li>
       
      </ul>
    </div>
   
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <!-- <div class="input-group input-group-outline">
              <label class="form-label">Type here...</label>
              <input type="text" class="form-control">
            </div> -->
          </div>
          <ul class="navbar-nav  justify-content-end">
           
            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </a>
            </li>
           
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12">
          <div class="card my-4">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
              <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                <h6 class="text-white text-capitalize ps-3">Add banner</h6>
              </div>
            </div>
            <div class="card-body px-0 pb-2">
              <div class="table-responsive p-0">
              


                





                <div class="main-panel">
                  <div class="content-wrapper">
                      <div class="col-12 grid-margin stretch-card">
                          <div class="card">
                              <div class="card-body">
                                
                                  <form class="forms-sample border p-3" id="addProductForm" method="post" action="/admin/addbanner" enctype="multipart/form-data" onsubmit="return validateBannerForm()" >                                      <div class="form-group row">
                                         
                                    <div class="col-3 mb-3">
                                      <input type="text" class="form-control" name="mainHead" id="mainHead" placeholder="Main Head" required>
                                      <p id="product-name-error" class="error-message"></p>
                                  </div>
                                  <div class="col-3 mb-3">
                                    <input type="text" class="form-control" name="typeHead" id="typeHead" placeholder="type Head" required>
                                    <p id="type-head-error" class="error-message"></p>
                                </div>
                                  
                                  <div class="col-3 mb-3">
                                      <input type="text" class="form-control" id="product_price" name="discription" placeholder="description" required>
                                      <p id="product-price-error" class="error-message"></p>
                                  </div>
                                  
                                  
                                  
                                  <div class="col-3 mb-3">
                                      <textarea name="url" class="form-control" id="product_description" placeholder="url" rows="1" required></textarea>
                                      <p id="product-description-error" class="error-message"></p>
                                  </div>
                                  
                            
                                  
                                      </div>
                                      
                                      
                                      
                                   
                                      
                                      <div class="row d-flex justify-content-center">
                                        <!-- Image 1 -->
                                        
                                        <div class="col-lg-3">
                                          <div id="imagePreview1" class="image-preview"></div>
                                          <label for="imageInput1" class="image-label">Image 1
                                              <input name="image1" type="file" accept="image/*" id="imageInput1" class="form-control-file" required>
                                          </label>
                                          <p id="image-error1" class="error-message"></p>
                                          <!-- Add a hidden input field for the cropped image data -->
                                          <input type="hidden" name="croppedImageData1" id="croppedImageData1">
                                          <p id="cropped-image-error1" class="error-message"></p>
                                      </div>
                                 
                                      </div>
                                      <button type="submit" id="cropAndSubmit" class="btn btn-md btn-outline-primary mr-2 mt-5">Add banner</button>

                                  </form>

                               


                              
                                


                              </div>
                          </div>
                      </div>
                  </div>
                  <footer class="footer"></footer>
              </div>
              
              
          
              












              </div>
            </div>
          </div>
        </div>
      </div>
   
    </div>
  </main>
  







<style>
  .crop-image {
    max-width: 15cm;
    max-height: 10cm;
    width: 100%; /* Ensure the image takes the full width of the container */
    height: auto; /* Maintain aspect ratio */
    display: inline-block;
    margin-right: 10px; /* Adjust as needed for spacing between crop boxes */
  }
</style>


  



<script>
 
</script>




<script defer>
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof Cropper !== 'undefined') {
      var imageInputs = document.querySelectorAll('[id^="imageInput"]');
      var form = document.getElementById('addProductForm'); // Use the form ID

      imageInputs.forEach(function (input, index) {
        var cropper;
        var imgElement = document.createElement('img');

        // Add a class to the imgElement for styling
        imgElement.classList.add('crop-image');

        // Insert the imgElement after the input
        input.parentNode.insertBefore(imgElement, input.nextSibling);

        // Add a container for the preview
        var previewContainer = document.createElement('div');
        previewContainer.id = 'imagePreview' + (index + 1);
        previewContainer.classList.add('image-preview');
        input.parentNode.insertBefore(previewContainer, imgElement.nextSibling);

        input.addEventListener('change', function (e) {
          var files = e.target.files;
          if (files && files[0]) {
            var reader = new FileReader();
            reader.onload = function (event) {
              // Replace the src attribute of the imgElement with the selected image
              imgElement.src = event.target.result;

              // Initialize CropperJS with the imgElement
              cropper = new Cropper(imgElement, {
                aspectRatio: 16/9,
                viewMode: 2,
                autoCropArea: 1,
              });

              // Adjust the position of the Cropper box after loading the image
              setTimeout(function () {
                cropper.getCropBoxData().top += cropper.getCropBoxData().height * 0.3;
                cropper.setCropBoxData(cropper.getCropBoxData());
              }, 100);

              // Prevent the default behavior of mousedown, mousemove, and touchmove events
              cropper.element.removeEventListener('mousedown', cropper._dragstart);
              cropper.element.removeEventListener('mousemove', cropper._dragmove);
              cropper.element.removeEventListener('touchmove', cropper._dragmove);

              // Prevent the default behavior of the input field during cropping
              input.addEventListener('click', function (event) {
                event.preventDefault();
              });

              // Show a button to trigger saving the cropped image
              var saveButton = document.createElement('button');
              saveButton.innerText = 'Save Cropped Image';
              saveButton.addEventListener('click', function (event) {
                event.preventDefault(); // Prevent the default form submission

                // Get the cropped image data URL
                var croppedImageData = cropper.getCroppedCanvas().toDataURL('image/jpeg');
                console.log('Cropped Image Data:', croppedImageData);

                // Set the cropped image data to the corresponding hidden input field
                document.getElementById('croppedImageData' + (index + 1)).value = croppedImageData;

                // Show the preview in the container
                var previewImage = document.createElement('img');
                previewImage.src = croppedImageData;
                previewContainer.innerHTML = ''; // Clear previous content
                previewContainer.appendChild(previewImage);

                // Now, you can choose to submit the form or do other actions
                // form.submit(); 
              });

              // Insert the save button after the imgElement
              imgElement.parentNode.insertBefore(saveButton, imgElement.nextSibling);
            };

            // Create a Blob from the file and read it as a data URL
            reader.readAsDataURL(new Blob([files[0]], { type: 'image/jpeg' }));
          }
        });
      });

      // Add an event listener to the "Add Product" button to trigger the cropping process
      document.getElementById('cropAndSubmit').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent the default form submission
        if (validateBannerForm()) {
        cropImagesAndSubmit(); 
        }// Trigger the cropping process
       // Trigger the cropping process
      });

     
      function validateBannerForm() {
    const mainHead = document.getElementById('mainHead').value;
    const typeHead = document.getElementById('typeHead').value;
    const description = document.getElementById('product_price').value;
    const url = document.getElementById('product_description').value;
    const image = document.getElementById('imageInput1').files[0];

    // Clear previous error messages
    document.getElementById('product-name-error').textContent = '';
    document.getElementById('type-head-error').textContent = '';
    document.getElementById('product-price-error').textContent = '';
    document.getElementById('product-description-error').textContent = '';
    document.getElementById('image-error1').textContent = '';

    // Validate main head
    if (!mainHead) {
        document.getElementById('product-name-error').textContent = 'Main Head should not be empty!';
        return false;
    }

    // Validate type head
    if (!typeHead) {
        document.getElementById('type-head-error').textContent = 'Type Head should not be empty!';
        return false;
    }

    // Validate description
    if (!description) {
        document.getElementById('product-price-error').textContent = 'Description should not be empty!';
        return false;
    }

    // Validate URL
    if (!url) {
        document.getElementById('product-description-error').textContent = 'URL should not be empty!';
        return false;
    }

    // Validate image
    if (!image) {
        document.getElementById('image-error1').textContent = 'Please upload Image 1.';
        return false;
    }

    // You can add additional image validation here if needed.

    return true; // Return true if validation passes, false otherwise
}

      // Function to crop images and submit the form
      function cropImagesAndSubmit() {
        // Iterate through each input and trigger cropping process
        imageInputs.forEach(function (input, index) {
          // Trigger the change event on each input
          input.dispatchEvent(new Event('change'));
        });

        // After all images are cropped, submit the form
        form.submit();
      }

    } else {
      console.error('CropperJS is not defined. Check the CDN script paths.');
    }
  });

  // Function to convert data URI to Blob
  function dataURItoBlob(dataURI) {
    var byteString = atob(dataURI.split(',')[1]);
    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
    var ab = new ArrayBuffer(byteString.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
    }
    return new Blob([ab], { type: mimeString });
  }
</script>






<style>
  .error-message {
      color: red;
      font-size: 14px;
      margin-top: 5px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
  }
</style>


  
  
  
  

  
  
  
    
  
  
  
  
  
  

  <!--   Core JS Files   -->
  <script src="/public/admin/js/core/popper.min.js"></script>
  <script src="/public/admin/js/core/bootstrap.min.js"></script>
  <script src="/public/admin/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="/public/admin/js/plugins/smooth-scrollbar.min.js"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/public/admin/js/material-dashboard.min.js?v=3.0.0"></script>
  <%-include("../adminlayouts/footer.ejs")-%>